## Коммуникация

### Первый - Второй слой
Все данные собранные трекером, в зависимости от его источника, 
будут ставится в DB с ключом 
```
<source>_<input>-<output>
```
в виде типа <layers.tracker.models.Bid> в формате JSON. А далее 
второй слой сможет вытащить текущий курс обработать его. 

### Второй - Третий слой
Второй слой кидает все возможные для прохода цыклы в третий слой через pub/sub на один во всей системе публичный ключ, к примеру arbitrage. И третий слой уже принимает решение о покупке.


## Второй слой

Поверхностная архитектура второго слоя 
Второй слой получает текущие биды из первого слоя, фильтрует их в 
попытке найти выгодный арбитраж (также учитывая цикл состоящий не 
только из обмена всего двух валют, но также и бо́льшего числа транзакции), 
а потом передает их в третий слой. 

### Полная архитектура второго слоя
Изначально есть единая точка входа которая парсит все существующие 
ключи трекеров, и строит граф по этим трекерам, учитывая всевозможные 
накладные расходы и комиссии характерные для биржи и валюты каждого 
трекера. Далее производится итерация по этому графу с глубиной n=1 
(только пока), с обязательным условием вернуться обратно. Из всех 
возможных путей вытаскивается только самое выгодное и передается выше. 

Более низкоуровневое объяснение, строится граф из объектов хранящих 
бид, его биржу и накладные расходы для его покупки. К примеру есть 
бид USDT-TRX с комиссией 0.1% и бид TRX-USDT, закрывающий цикл с 
комиссией 0.1%.  Далее этот таск смотрит входную сумму, и сумму 
которая получается при произведение этого цикла, в случае его 
выгодности, бид передаёт найденный арбитраж на третий уровень через 
pub/sub.

Скорее всего, будет объект типо Overhead который будет отвечать 
за веса графов, хранящий вход и выход. И вход и выход будут хранить 
не только свою валюту, но также и свою биржу. В случае с крипто 
валютами, в поле возможных бирж будут хранится все имплементированные 
биржы, в случае же с фиатными, только биржа из бида. 

Также будет глобальный словарь хранящий в качестве ключа
валюту и биржу, а значение будет массив всех оверхедов
входом которого является ключ словаря. 


## Бот
### Уведомления 

Для уведомлений в боте будет запущен один поток который будет запущен 
асинхронно и хранит инстанс телеграм бота и проходится раз в 
какое-то время по всем пользователям и проверять исполнение их
уведомления. То есть можно получить пользователя по user_<user_id>
(чтобы зарегистрироваться надо написать /start), и там будет 
содержаться (помимо остальной информации в будущем) список 
ожидающих уведомлений. И соответсвенно так можно пройтись 
по всем пользователям.  
